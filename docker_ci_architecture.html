
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://proteus-framework.org/PROTEUS/docker_ci_architecture.html">
      
      
        <link rel="prev" href="ai_usage.html">
      
      
        <link rel="next" href="contact.html">
      
      
        
      
      
      <link rel="icon" href="assets/PROTEUS_black_on_white_logo_only.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Docker CI architecture - PROTEUS</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
  <!-- EXTRAHEAD OVERRIDE LOADED -->

  <link rel="icon" type="image/png"
        href="assets/PROTEUS_black_on_white_logo_only.png"
        media="(prefers-color-scheme: light)" />

  <link rel="icon" type="image/png"
        href="assets/PROTEUS_white_on_black_logo_only.png"
        media="(prefers-color-scheme: dark)" />

  <script>
  (function () {
    function setFavicon(href) {
      document.querySelectorAll(
      'link[rel="icon"], link[rel="shortcut icon"], link[rel="apple-touch-icon"]'
      ).forEach(el => el.remove());

      const link = document.createElement('link');
      link.rel = 'icon';
      link.type = 'image/png';
      link.href = href;
      document.head.appendChild(link);

      const link2 = document.createElement('link');
      link2.rel = 'shortcut icon';
      link2.type = 'image/png';
      link2.href = href;
      document.head.appendChild(link2);
      }


    const light = "assets/PROTEUS_black_on_white_logo_only.png";
    const dark  = "assets/PROTEUS_white_on_black_logo_only.png";

    const mql = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

    function apply() {
      // cache-bust to defeat Safari favicon cache
      const v = Date.now();
      setFavicon((mql && mql.matches ? dark : light) + '?v=' + v);
    }

    apply();
    if (mql) {
      if (mql.addEventListener) mql.addEventListener('change', apply);
      else if (mql.addListener) mql.addListener(apply);
    }
  })();
  </script>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker-based-cicd-architecture-for-proteus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="PROTEUS" class="md-header__button md-logo" aria-label="PROTEUS" data-md-component="logo">
      
  <img src="assets/PROTEUS_white_on_black.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PROTEUS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker CI architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/FormingWorlds/PROTEUS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="PROTEUS" class="md-nav__button md-logo" aria-label="PROTEUS" data-md-component="logo">
      
  <img src="assets/PROTEUS_white_on_black.png" alt="logo">

    </a>
    PROTEUS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FormingWorlds/PROTEUS" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="model.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model description
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="usage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using PROTEUS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="config.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="troubleshooting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Platform Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Platform Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="local_machine_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local machine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="kapteyn_cluster_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kapteyn cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="snellius_cluster_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snellius cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="habrok_cluster_guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Habrok cluster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="inference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bayesian inference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="data.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="bibliography.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bibliography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CONTRIBUTING.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="test_infrastructure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="test_categorization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test categorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="test_building.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test building
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ai_usage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI-assisted development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Docker CI architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="docker_ci_architecture.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker CI architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-document-is-for" class="md-nav__link">
    <span class="md-ellipsis">
      
        What This Document Is For
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Dockerfile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-docker-buildyml-the-updater" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. docker-build.yml (The Updater)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ci-pr-checksyml-fast-feedback" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. ci-pr-checks.yml (Fast Feedback)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-ci-nightlyyml-deep-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. ci-nightly.yml (Deep Validation)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-markers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Markers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Sequence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Workflow Sequence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nightly-main-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nightly (Main Branch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pull Request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#speed-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Speed Improvements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scientific-rigor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scientific Rigor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-experience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developer Experience
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-docker-image-rebuilds" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Docker Image Rebuilds
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-size-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Size Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coverage-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage Coordination
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-build-fails" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Build Fails
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smart-rebuild-not-working" class="md-nav__link">
    <span class="md-ellipsis">
      
        Smart Rebuild Not Working
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-fail-in-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tests Fail in Container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-too-large" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Too Large
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proteus-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        PROTEUS Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/people" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contact.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contact
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="CODE_OF_CONDUCT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="funding.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Funding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Source & Issues
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Source & Issues
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/FormingWorlds/PROTEUS" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Source code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/FormingWorlds/PROTEUS/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Issues page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Submodule Docs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Submodule Docs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/MORS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— MORS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/JANUS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— JANUS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/ZEPHYRUS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— ZEPHYRUS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/CALLIOPE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— CALLIOPE
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.h-nicholls.space/AGNI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— AGNI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/Obliqua/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— Obliqua
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/VULCAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— VULCAN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/Zalmoxis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— Zalmoxis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/aragog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— Aragog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://proteus-framework.org/SPIDER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— SPIDER
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://atmodeller.readthedocs.io/en/latest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— Atmodeller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://newstrangeworlds.github.io/FastChem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— FastChem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://platon.readthedocs.io/en/latest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ðŸ”— PLATON
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-this-document-is-for" class="md-nav__link">
    <span class="md-ellipsis">
      
        What This Document Is For
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Dockerfile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-docker-buildyml-the-updater" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. docker-build.yml (The Updater)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ci-pr-checksyml-fast-feedback" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. ci-pr-checks.yml (Fast Feedback)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-ci-nightlyyml-deep-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. ci-nightly.yml (Deep Validation)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-markers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Markers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow Sequence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Workflow Sequence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nightly-main-branch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nightly (Main Branch)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pull Request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#speed-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Speed Improvements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Efficiency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scientific-rigor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scientific Rigor
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developer-experience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Developer Experience
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-docker-image-rebuilds" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Docker Image Rebuilds
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-size-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Size Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cache Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coverage-coordination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coverage Coordination
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#image-build-fails" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Build Fails
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smart-rebuild-not-working" class="md-nav__link">
    <span class="md-ellipsis">
      
        Smart Rebuild Not Working
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-fail-in-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tests Fail in Container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-too-large" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Too Large
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        References
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proteus-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        PROTEUS Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Resources
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="docker-based-cicd-architecture-for-proteus">Docker-Based CI/CD Architecture for PROTEUS</h1>
<h2 id="what-this-document-is-for">What This Document Is For</h2>
<p><strong>New to PROTEUS CI?</strong> This document explains how our Docker-based testing infrastructure works. Docker containers provide a consistent environment with pre-compiled physics modules, making CI runs fast and reproducible.</p>
<p><strong>Key concept:</strong> Instead of compiling SOCRATES, AGNI, PETSc, and SPIDER on every CI run (~60 min), we use a pre-built Docker image (~5 min startup).</p>
<p>For test markers and categories, see <a href="test_categorization.html">Test Categorization</a>. For coverage workflows, see <a href="test_infrastructure.html">Test Infrastructure</a>. For writing tests, see <a href="test_building.html">Test Building</a>.</p>
<hr />
<h2 id="overview">Overview</h2>
<p>This architecture solves slow compilation times by using a pre-built Docker image containing the full PROTEUS environment with compiled physics modules. The image is built on demand and used by all CI/CD workflows.</p>
<h2 id="architecture-components">Architecture Components</h2>
<h3 id="1-dockerfile">1. Dockerfile</h3>
<p><strong>Location:</strong> <code>/Dockerfile</code></p>
<p><strong>Purpose:</strong> Define the pre-built environment with all dependencies and compiled physics modules.</p>
<p><strong>Key Features:</strong>
- Base: Python 3.12 on Debian Bookworm (slim)
- System dependencies: gfortran, make, cmake, git, NetCDF libraries
- Julia installation via official installer
- Compiles all physics modules:
  - SOCRATES (radiative transfer)
  - PETSc (numerical computing)
  - SPIDER (interior evolution)
  - AGNI (radiative-convective atmosphere)
- Installs Python packages from <code>pyproject.toml</code>
- Optimized for size with cache cleanup</p>
<p><strong>Environment Variables:</strong>
<div class="highlight"><pre><span></span><code><span class="nv">FWL_DATA</span><span class="o">=</span>/opt/proteus/fwl_data
<span class="nv">RAD_DIR</span><span class="o">=</span>/opt/proteus/socrates
<span class="nv">AGNI_DIR</span><span class="o">=</span>/opt/proteus/AGNI
<span class="nv">PETSC_DIR</span><span class="o">=</span>/opt/proteus/petsc
<span class="nv">PETSC_ARCH</span><span class="o">=</span>arch-linux-c-opt
<span class="nv">PROTEUS_DIR</span><span class="o">=</span>/opt/proteus
</code></pre></div></p>
<h3 id="2-docker-buildyml-the-updater">2. docker-build.yml (The Updater)</h3>
<p><strong>Location:</strong> <code>.github/workflows/docker-build.yml</code></p>
<p><strong>Purpose:</strong> Build and push the Docker image to GitHub Container Registry.</p>
<p><strong>Triggers:</strong>
- Schedule: Nightly at 02:00 UTC
- Push to <code>main</code> when dependencies change:
  - <code>pyproject.toml</code>
  - <code>environment.yml</code>
  - <code>Dockerfile</code>
  - <code>tools/get_*.sh</code> scripts</p>
<p><strong>Output:</strong> <code>ghcr.io/formingworlds/proteus:latest</code></p>
<p><strong>Tags:</strong>
- <code>latest</code> (on main branch)
- <code>&lt;branch&gt;-&lt;sha&gt;</code> (commit-specific)
- <code>nightly-YYYYMMDD</code> (daily builds)</p>
<p><strong>Optimization:</strong>
- BuildKit cache for faster rebuilds
- Layer caching from previous builds
- Multi-stage optimization potential</p>
<h3 id="3-ci-pr-checksyml-fast-feedback">3. ci-pr-checks.yml (Fast Feedback)</h3>
<p><strong>Location:</strong> <code>.github/workflows/ci-pr-checks.yml</code></p>
<p><strong>Purpose:</strong> Fast PR validation using pre-built Docker image.</p>
<p><strong>Triggers:</strong>
- Pull requests to <code>main</code>
- Push to <code>main</code>
- Manual dispatch</p>
<p><strong>Strategy:</strong>
1. <strong>Container:</strong> Runs inside <code>ghcr.io/formingworlds/proteus:latest</code> (or branch-specific tag)
2. <strong>Threshold check:</strong> Prevents coverage decreases vs main
3. <strong>Code Overlay:</strong> Overlays PR code onto container (excludes compiled modules)
4. <strong>Structure validation:</strong> <code>tools/validate_test_structure.sh</code>
5. <strong>Sequential testing:</strong> Unit â†’ Smart rebuild â†’ Smoke
6. <strong>Coverage coordination:</strong> Downloads nightly artifact for estimated total</p>
<p><strong>Jobs:</strong></p>
<ul>
<li><strong>unit-tests</strong> (Linux, Docker): Unit + smoke tests with coverage, coverage validation</li>
<li><strong>macos-unit-tests</strong> (macOS): Unit tests only (no compiled binaries available)</li>
<li><strong>lint</strong>: Code style checks with ruff</li>
<li><strong>summary</strong>: Aggregates results from all jobs into a unified report</li>
</ul>
<p><strong>Linux job steps (in order):</strong></p>
<ol>
<li><strong>Prevent threshold decreases</strong> â€” Fails if <code>fail_under</code> decreased vs main</li>
<li><strong>Overlay PR code</strong> â€” <code>rsync</code> excludes SPIDER, SOCRATES, PETSc, AGNI</li>
<li><strong>Validate test structure</strong> â€” Ensures <code>tests/</code> mirrors <code>src/proteus/</code></li>
<li><strong>Run unit tests</strong> â€” <code>pytest -m "unit and not skip"</code> with coverage</li>
<li><strong>Smart rebuild</strong> â€” Recompile SOCRATES/AGNI only if sources changed</li>
<li><strong>Run smoke tests</strong> â€” <code>pytest -m "smoke and not skip"</code> (appends coverage)</li>
<li><strong>Download nightly coverage</strong> â€” For estimated total calculation</li>
<li><strong>Check staleness</strong> â€” Fails if nightly artifact &gt;48h old</li>
<li><strong>Validate coverage</strong> â€” Grace period of 0.3% for drops</li>
<li><strong>Diff-cover</strong> â€” 80% coverage required on changed lines</li>
</ol>
<p><strong>Coverage coordination:</strong>
- Fast gate threshold from <code>[tool.proteus.coverage_fast] fail_under</code> (see <code>pyproject.toml</code>)
- Estimated total = union of PR lines + nightly integration lines
- Grace period allows â‰¤0.3% drop with warning
- Diff-cover enforces 80% on changed lines</p>
<p>See <a href="test_categorization.html">Test Categorization</a> for marker details and <a href="test_infrastructure.html">Test Infrastructure</a> for coverage thresholds.</p>
<p><strong>Key Innovation - Smart Rebuild:</strong>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Smart rebuild of physics modules</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no"># Only rebuild if source files changed</span>
<span class="w">    </span><span class="no">cd SPIDER</span>
<span class="w">    </span><span class="no">make -q || make -j$(nproc)  # -q checks if build is up-to-date</span>
</code></pre></div></p>
<p>Since the container already has compiled binaries:
- If PR changes only Python files: No recompilation needed (~instant)
- If PR changes Fortran/C files: Only changed files recompile (~seconds to minutes)
- Full compilation avoided (~30-60 minutes saved)</p>
<h3 id="4-ci-nightlyyml-deep-validation">4. ci-nightly.yml (Deep Validation)</h3>
<p><strong>Location:</strong> <code>.github/workflows/ci-nightly.yml</code></p>
<p><strong>Purpose:</strong> Comprehensive scientific validation and coverage baseline.</p>
<p><strong>Triggers:</strong>
- Primary: Dispatched by <code>docker-build.yml</code> after the 2am UTC image rebuild
- Fallback: Cron at 03:00 UTC (skips if a dispatch run already happened in the last 4 hours)
- Manual dispatch</p>
<p><strong>Deduplication:</strong> A <code>check-already-triggered</code> guard job queries the GitHub API for recent <code>workflow_dispatch</code> runs. If the docker-build workflow already triggered the nightly, the 3am cron skips. On API failure, the cron proceeds as a safe default.</p>
<p><strong>Environment:</strong>
- Sets <code>PROTEUS_CI_NIGHTLY=1</code> â€” enables additional smoke tests
- Timeout: 240 minutes (4 hours)
- Downloads ~200MB minimal data for smoke tests</p>
<p><strong>Strategy:</strong>
1. Check if already triggered by docker-build (skip if so)
2. Use branch-specific Docker image
3. Overlay code (excludes compiled modules)
4. Download minimal data (spectral files, stellar spectra, lookup tables)
5. Configure Julia environment for Python integration
6. Run all test tiers sequentially
7. Upload aggregate coverage to Codecov
8. Generate coverage artifacts for PR coordination
9. Ratchet coverage threshold on success</p>
<p><strong>Test sequence:</strong>
1. <strong>Unit tests</strong> â€” <code>pytest -m "unit and not skip"</code> with coverage
2. <strong>Smoke tests</strong> â€” <code>pytest -m "smoke and not skip"</code> (coverage appended)
3. <strong>Integration tests</strong> â€” <code>pytest -m "integration and not slow"</code> (coverage appended)
4. <strong>Slow tests</strong> â€” <code>pytest -m slow</code> (if time permits)</p>
<p><strong>Codecov upload:</strong>
- Uploads combined <code>coverage.xml</code> (unit + smoke + integration) under the <code>nightly</code> flag
- Configured in <code>codecov.yml</code> with <code>carryforward: true</code> so data persists across PR evaluations
- This is what the Codecov coverage badge in the README reflects</p>
<p><strong>Artifacts uploaded:</strong>
- <code>nightly-coverage/coverage-integration-only.json</code> â€” For PR estimated total
- <code>nightly-coverage/nightly-timestamp.txt</code> â€” For staleness detection
- <code>nightly-coverage/coverage-by-type.json</code> â€” Breakdown by test type</p>
<p><strong>Coverage ratcheting:</strong>
- Full threshold from <code>[tool.coverage.report] fail_under</code> (see <code>pyproject.toml</code>)
- Auto-commits threshold increase on successful main runs</p>
<p>See <a href="test_infrastructure.html">Test Infrastructure</a> for coverage coordination details.</p>
<h2 id="test-markers">Test Markers</h2>
<p>Tests are categorized using pytest markers defined in <code>pyproject.toml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Unit test (fast, mocked physics)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_config_parsing</span><span class="p">():</span>
    <span class="c1"># Test Python logic without heavy dependencies</span>
    <span class="k">pass</span>

<span class="c1"># Smoke test (quick real binary check)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">smoke</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_spider_single_timestep</span><span class="p">():</span>
    <span class="c1"># Run SPIDER for 1 timestep at low resolution</span>
    <span class="c1"># Ensures binary actually works</span>
    <span class="k">pass</span>

<span class="c1"># Integration test (multi-module)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_atmosphere_interior_coupling</span><span class="p">():</span>
    <span class="c1"># Test interaction between JANUS and SPIDER</span>
    <span class="k">pass</span>

<span class="c1"># Slow test (full scientific validation)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_earth_evolution_1gyr</span><span class="p">():</span>
    <span class="c1"># Run full 1 Gyr simulation</span>
    <span class="c1"># Validate against known results</span>
    <span class="k">pass</span>
</code></pre></div>
<h2 id="workflow-sequence">Workflow Sequence</h2>
<h3 id="nightly-main-branch">Nightly (Main Branch)</h3>
<div class="highlight"><pre><span></span><code>02:00 UTC: docker-build.yml
  â†“
  Rebuild Docker image
  â†“
  Trigger ci-nightly.yml via workflow_dispatch
  â†“
03:00 UTC: ci-nightly.yml cron (fallback)
  â†“
  check-already-triggered job
  â†“  (skips if dispatch run found in last 4h)
  Pull Docker image
  â†“
  Overlay code, download data (~200MB)
  â†“
  Run unit tests with coverage
  â†“
  Run smoke tests (PROTEUS_CI_NIGHTLY=1 enables extras)
  â†“
  Run integration tests
  â†“
  Run slow tests (if time permits)
  â†“
  Upload aggregate coverage to Codecov (nightly flag)
  â†“
  Upload nightly-coverage artifact
  â†“
  Ratchet threshold if coverage increased
</code></pre></div>
<h3 id="pull-request">Pull Request</h3>
<div class="highlight"><pre><span></span><code>PR opened/updated
  â†“
ci-pr-checks.yml (3 parallel jobs + summary)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ unit-tests (Linux)   â”‚ macos-unit-tests â”‚ lint       â”‚
â”‚ Pull Docker image    â”‚ Setup Python     â”‚ ruff check â”‚
â”‚ Overlay PR code      â”‚ pip install      â”‚ ruff formatâ”‚
â”‚ Validate structure   â”‚ Run unit tests   â”‚            â”‚
â”‚ Unit tests + cov     â”‚                  â”‚            â”‚
â”‚ Smart rebuild        â”‚                  â”‚            â”‚
â”‚ Smoke tests          â”‚                  â”‚            â”‚
â”‚ Coverage validation  â”‚                  â”‚            â”‚
â”‚ Diff-cover (80%)     â”‚                  â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    summary job
                    (unified report)
                          â†“
                  Fast feedback (~10-15 min)
</code></pre></div>
<h2 id="benefits">Benefits</h2>
<h3 id="speed-improvements">Speed Improvements</h3>
<ul>
<li><strong>Before:</strong> Every PR compiles SOCRATES, PETSc, SPIDER, AGNI (~60 minutes)</li>
<li><strong>After:</strong> Use pre-built image, smart rebuild only (~5-10 minutes for Python-only changes)</li>
<li><strong>Savings:</strong> ~50 minutes per PR iteration</li>
</ul>
<h3 id="resource-efficiency">Resource Efficiency</h3>
<ul>
<li>Docker layer caching reduces rebuild time</li>
<li>Smart recompilation only builds changed files</li>
<li>Parallel job execution where possible</li>
</ul>
<h3 id="scientific-rigor">Scientific Rigor</h3>
<ul>
<li>Nightly comprehensive validation ensures correctness</li>
<li>PR checks provide fast feedback without compromising quality</li>
<li>Separation of fast unit tests from slow integration tests</li>
</ul>
<h3 id="developer-experience">Developer Experience</h3>
<ul>
<li>Fast PR checks (~10-15 min) enable rapid iteration</li>
<li>Clear test markers guide test writing</li>
<li>Comprehensive nightly validation catches regressions</li>
</ul>
<h2 id="image-maintenance">Image Maintenance</h2>
<h3 id="when-docker-image-rebuilds">When Docker Image Rebuilds</h3>
<ol>
<li>Nightly at 02:00 UTC (scheduled)</li>
<li>Changes to <code>pyproject.toml</code> (dependency updates)</li>
<li>Changes to <code>environment.yml</code> (conda dependencies)</li>
<li>Changes to <code>Dockerfile</code> (build process)</li>
<li>Changes to <code>tools/get_*.sh</code> (compilation scripts)</li>
</ol>
<h3 id="image-size-management">Image Size Management</h3>
<ul>
<li>Cleanup layers remove apt cache, Python cache</li>
<li>Multi-stage builds potential for further optimization</li>
<li>Current estimated size: ~2-3 GB (with compiled modules)</li>
</ul>
<h3 id="cache-strategy">Cache Strategy</h3>
<ul>
<li>BuildKit cache stored in registry</li>
<li>Layer caching from previous builds</li>
<li>Fast incremental builds</li>
</ul>
<h2 id="coverage-coordination">Coverage Coordination</h2>
<p>The two-tier coverage system coordinates between nightly and PR workflows:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fast gate</td>
<td><code>pyproject.toml</code></td>
<td>PR threshold (unit + smoke)</td>
</tr>
<tr>
<td>Full gate</td>
<td><code>pyproject.toml</code></td>
<td>Nightly threshold (all tests)</td>
</tr>
<tr>
<td>Grace period</td>
<td>0.3%</td>
<td>PRs can merge with small drops</td>
</tr>
<tr>
<td>Staleness</td>
<td>48h</td>
<td>PR fails if nightly too old</td>
</tr>
<tr>
<td>Diff-cover</td>
<td>80%</td>
<td>Required on changed lines</td>
</tr>
</tbody>
</table>
<p><strong>How estimated total works:</strong>
1. PR runs unit + smoke â†’ <code>coverage-unit.json</code>
2. Download nightly's <code>coverage-integration-only.json</code>
3. Compute union of covered lines
4. Compare against full threshold</p>
<p>See <a href="test_infrastructure.html">Test Infrastructure</a> for threshold details.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="image-build-fails">Image Build Fails</h3>
<ul>
<li>Check GitHub Actions logs in <code>docker-build.yml</code></li>
<li>Verify compilation scripts work locally</li>
<li>Test Dockerfile locally: <code>docker build -t proteus-test .</code></li>
</ul>
<h3 id="smart-rebuild-not-working">Smart Rebuild Not Working</h3>
<ul>
<li>Verify make is installed in container</li>
<li>Check if Makefiles are copied correctly</li>
<li>Manual rebuild: Remove binaries and rebuild</li>
</ul>
<h3 id="tests-fail-in-container">Tests Fail in Container</h3>
<ul>
<li>Test locally with: <code>docker run -it ghcr.io/formingworlds/proteus:latest bash</code></li>
<li>Verify environment variables are set</li>
<li>Check file permissions</li>
</ul>
<h3 id="image-too-large">Image Too Large</h3>
<ul>
<li>Review cleanup steps in Dockerfile</li>
<li>Consider multi-stage builds</li>
<li>Analyze layers: <code>docker history ghcr.io/formingworlds/proteus:latest</code></li>
</ul>
<h2 id="future-enhancements">Future Enhancements</h2>
<ol>
<li><strong>Multi-architecture Support:</strong> Build for ARM64 (Apple Silicon)</li>
<li><strong>Version Tagging:</strong> Semantic versioning for stable releases</li>
<li><strong>Matrix Testing:</strong> Multiple Python versions (3.11, 3.12, 3.13)</li>
<li><strong>Performance Profiling:</strong> Benchmark tests across versions</li>
<li><strong>Artifact Caching:</strong> Cache FWL_DATA between runs</li>
</ol>
<h2 id="references">References</h2>
<h3 id="proteus-documentation">PROTEUS Documentation</h3>
<ul>
<li><a href="test_infrastructure.html">Test Infrastructure</a> â€” Coverage workflows, thresholds, troubleshooting</li>
<li><a href="test_categorization.html">Test Categorization</a> â€” Test markers, CI pipelines, fixtures</li>
<li><a href="test_building.html">Test Building</a> â€” Writing tests, prompts, best practices</li>
<li><a href="ai_usage.html">AI-Assisted Development</a> â€” Using AI for tests and code review</li>
</ul>
<h3 id="external-resources">External Resources</h3>
<ul>
<li><a href="https://docs.docker.com/develop/dev-best-practices/">Docker Best Practices</a></li>
<li><a href="https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container">GitHub Actions: Container Jobs</a></li>
<li><a href="https://docs.pytest.org/en/stable/example/markers.html">pytest Markers</a></li>
<li><a href="https://coverage.readthedocs.io/">coverage.py Documentation</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["content.code.copy", "content.tabs.link", "navigation.expand"], "search": "assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>